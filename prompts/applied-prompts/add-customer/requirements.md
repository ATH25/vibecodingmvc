

Add Customer Feature — Requirements

Scope

Create a complete “Customer” feature using the same patterns as the Beer feature (entities, DTOs, MapStruct, services, repositories, controllers, Springdoc annotations, Redocly split docs, Flyway migration).

Data model

Table: customer
Fields & constraints
•	id (PK, int, identity)
•	version (int, optimistic locking)
•	name (varchar(120), NOT NULL)
•	email (varchar(255), unique, NOT NULL)
•	phone (varchar(40), nullable)
•	address_line1 (varchar(200), NOT NULL)
•	address_line2 (varchar(200), nullable)
•	city (varchar(120), nullable)
•	state (varchar(80), nullable)
•	postal_code (varchar(20), nullable)
•	created_date (timestamp, default now)
•	updated_date (timestamp, default now)

Flyway migration

Create the next migration (increment N): src/main/resources/db/migration/VN__customer.sql

-- Customers
CREATE TABLE IF NOT EXISTS customer (
id               INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
version          INTEGER NOT NULL DEFAULT 0,
name             VARCHAR(120) NOT NULL,
email            VARCHAR(255) NOT NULL,
phone            VARCHAR(40),
address_line1    VARCHAR(200) NOT NULL,
address_line2    VARCHAR(200),
city             VARCHAR(120),
state            VARCHAR(80),
postal_code      VARCHAR(20),
created_date     TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
updated_date     TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE UNIQUE INDEX IF NOT EXISTS uq_customer_email ON customer(email);

Keep syntax H2/Postgres-friendly. If the previous migration is V1__..., use V2__customer.sql, etc.

Java components (packages mirror existing project)
•	Entity: entities.Customer
•	Maps the fields above; @Version on version; @CreationTimestamp/@UpdateTimestamp for dates.
•	DTOs (records):
•	models.CustomerRequestDto
•	@NotBlank @Size(max=120) String name
•	@NotBlank @Email @Size(max=255) String email
•	@Size(max=40) String phone
•	@NotBlank @Size(max=200) String addressLine1
•	@Size(max=200) String addressLine2
•	@Size(max=120) String city
•	@Size(max=80) String state
•	@Size(max=20) String postalCode
•	models.CustomerResponseDto
•	All readable fields: id, version, name, email, phone, address*, city, state, postalCode, createdDate, updatedDate.
•	Mapper: mappers.CustomerMapper (MapStruct)
•	Customer toEntity(CustomerRequestDto)
•	CustomerResponseDto toResponse(Customer)
•	void update(@MappingTarget Customer, CustomerRequestDto) (IGNORE nulls)
•	Repository: repositories.CustomerRepository extends JpaRepository<Customer, Integer>
•	boolean existsByEmail(String email)
•	Service:
•	Interface services.CustomerService: list(), get(id), create(dto), update(id,dto), delete(id)
•	Impl services.impl.CustomerServiceImpl with basic validations (e.g., unique email).
•	Controller: controllers.CustomerController
•	Base path: /api/v1/customers
•	Methods:
•	GET /api/v1/customers → 200 list
•	GET /api/v1/customers/{id} → 200 item, 404 no body
•	POST /api/v1/customers → 201 item (consider Location header)
•	PUT /api/v1/customers/{id} → 200 item, 404 no body
•	DELETE /api/v1/customers/{id} → 204 no body, 404 no body

API & documentation
•	Use Springdoc annotations:
•	Controller @Tag(name="Customers", description="Operations for managing customers")
•	Methods: @Operation(summary, description), @ApiResponse with:
•	200/201 responses returning CustomerResponseDto
•	204/404 responses description-only (no content)
•	400 “Validation error” where applicable
•	DTO fields: @Schema(description, example) that match realistic data.
•	Redocly (split structure)
•	Add path files:
•	openapi/paths/api_v1_customers.yaml (GET list, POST create)
•	openapi/paths/api_v1_customers_{id}.yaml (GET/PUT/DELETE)
•	Add schemas:
•	openapi/components/schemas/CustomerRequestDto.yaml
•	openapi/components/schemas/CustomerResponseDto.yaml
•	Wire them in openapi/openapi.yaml under paths and components.schemas.
•	Keep 400 as description-only unless a body is explicitly required; keep 404/204 without bodies.

Acceptance checks
•	App starts; Flyway applies the new migration; table exists.
•	CRUD endpoints work with expected status codes (201/200/204/404, 400 on validation).
•	Swagger UI shows Customers tag and operations.
•	Redocly:
•	npx @redocly/cli lint openapi.yaml passes
•	npx @redocly/cli preview --port 8089 renders new endpoints

Non-goals
•	No authentication/authorization.
•	No partial updates (PATCH) for now.
•	No pagination/filtering (can be added later).

⸻
